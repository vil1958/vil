https://learn.microsoft.com/ru-ru/windows-server/storage/file-server/troubleshoot/detect-enable-and-disable-smbv1-v2-v3?tabs=server

Обнаружить:
`Get-SmbServerConfiguration | Select EnableSMB2Protocol`

Отключите:
'Set-SmbServerConfiguration -EnableSMB2Protocol $false'

Включите параметр:
`Set-SmbServerConfiguration -EnableSMB2Protocol $true`

#### [Как в Linux монтировать шару CIFS](https://www.dmosk.ru/miniinstruktions.php?mini=linux-cifs)

`sudo apt-get install cifs-utils`
### Сетевые порты
Если мы будем монтировать сетевую папку, сервер которой находится за брандмауэром, необходимо открыть следующие порты:
- 137/UDP
- 138/UDP
- 139/TCP
- 445/TCP

`mount.cifs <папка на сервере> <во что монтируем> <-o опции>`
_* вместо **mount.cifs** можно написать **mount -t cifs**_

Если нам не известны расшаренные папки на сервере, мы можем воспользоваться утилитой smbclient. Для начала установим ее.
`sudo apt install samba-client`

Теперь вводим:
`smbclient -L 192.168.1.1`

или, при необходимости авторизоваться на файловом сервере:
`smbclient -L 192.168.1.1 -U username`

Теперь монтирование можно выполнить следующей командой:
`mount.cifs //192.168.1.1/share /mnt -o user=nina`
_* в данном примере будет примонтирован каталог **share** на сервере **192.168.1.2** в локальную папку **/mnt** под учетной записью **nina**
#### Автоматическое монтирование CIFS через fstab
Для начала создаем файл, в котором будем хранить данные авторизации при подключении к общей папке:
`sudo vi /root/.smbclient`
И добавляем в него данные следующего вида:
```
username=nina  
password=dPassw0rd  
domain=nina.local
```
- * в этом примере создана пара логин/пароль — nina/**dPassw0rd**;_ **domain** указывать не обязательно, если аутентификация выполняется без него.

Задаем права на созданный файл, чтобы доступ был только у пользователя, скажем, root:
`sudo chmod 600 /root/.smbclient`
`sudo chown root:root /root/.smbclient`

Теперь открываем конфигурационный файл fstab:
`sudo vi /etc/fstab`
и добавляем в него следующее:
рабочее у Нины:
`//192.168.1.1/Transcend /mnt/Z cifs guest,vers=1.0,file_mode=0777,dir_mode=0777 0 0`

```
//192.168.1.1/share /mnt/Z cifs user,rw,credentials=/root/.smbclient 0 0
```
_* в данном примере выполняется монтирование общей папки **share** на сервере с IP-адресом **192.168.1.1** в каталог **/mnt/Z**. Параметры для подключения — **user**: позволяет выполнить монтирование любому пользователю, **rw**: с правом на чтение и запись, **credentials**: файл, который мы создали на предыдущем шаге._

Чтобы проверить правильность настроек, вводим следующую команду:
`mount -a`

### Версии SMB

Если на стороне Windows используется старая или слишком новая версия протокола SMB, при попытке монтирования мы можем получить ошибку **mount error(112): Host is down**. Чтобы это исправить, указываем версию:
`mount.cifs //192.168.1.1/share /mnt/Z -o vers=1.0`
_* монтирование по протоколу SMB1.0_

### Монтирование от гостевой учетной записи

Если сервер принимает запросы без логина и пароля, то клиент подключается, как гость:
`mount.cifs //192.168.1.1/share /mnt/Z -o guest`

или в fstab:
`//192.168.1.1/share    /mnt/Z    cifs    guest    0 0`

### Права на примонтированные каталоги

При монтировании папки мы можем указать определенные права:
`mount.cifs //192.168.1.10/share /mnt -o file_mode=0777,dir_mode=0777`

Для указания владельца, который будет назначен для примонтированного каталога, используем:
`mount.cifs //192.168.1.10/share /mnt -o uid=33,gid=33`
_* чтобы посмотреть идентификаторы пользователя, вводим **id -u <имя пользователя>** и **id -g <имя группы>**._


